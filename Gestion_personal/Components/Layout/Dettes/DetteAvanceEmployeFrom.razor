@using GestionPersonnel.Models.Avances
@using GestionPersonnel.Models.Dettes
@using GestionPersonnel.Models.Employe
@using GestionPersonnel.Services
@inject IEmployeService EmployeService
@inject IDetteService DetteService
@inject IAvanceService AvanceService

@if (IsVisibleFicheAvanceDette)
{
    <style>
        .modal-dialog {
            width: 750px;
            max-width: none;
        }

        .modal-content{
            max-width: none;
        }
    </style>
    <div class="modal" tabindex="-1" style="display: block;">
        <div class="modal-dialog" style="width:750px">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Historique de Dette et Avance</h5>
                  
                </div>

                <!-- Tables for Avance and Dette -->
                <div class="modal-body d-flex justify-content-between gap-4">
                    <!-- Left Table: Avance -->
                    <div class="table-container left-table w-100">
                        <h4 style="text-align:center">Avance</h4>
                        @if (avances != null && avances.Count > 0)
                        {
                            var totalAvance = avances.Sum(a => a.Montant);
                            <div style="overflow-y: auto; max-height: 200px;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var avance in avances)
                                        {
                                            <tr>
                                                <td>@avance.Date.ToString("yyyy-MM-dd")</td>
                                                <td>@avance.Montant</td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td><strong>Total</strong></td>
                                            <td><strong>@totalAvance</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                        }
                        else
                        {
                              <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Montant</th>
                                    </tr>
                                </thead>
                                <tbody>
                                  
                                        <tr>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                        </tr>
                                   
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td><strong>N/A</strong></td>
                                    </tr>
                                </tfoot>
                              </table>
                        }
                    </div>

                    <!-- Right Table: Dette -->
                    <div class="table-container right-table w-100">
                        <h4 style="text-align:center">Dette</h4>
                        @if (dettes != null && dettes.Count > 0)
                        {
                            var totalDette = dettes.Sum(d => d.Montant);
                            <div style="overflow-y: auto; max-height: 200px;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Montant</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var dette in dettes)
                                        {
                                            <tr>
                                                <td>@dette.Date.ToString("yyyy-MM-dd")</td>
                                                <td>@dette.Montant</td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td><strong>Total</strong></td>
                                            <td><strong>@totalDette</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        }
                        else
                        {
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Montant</th>
                                    </tr>
                                </thead>
                                <tbody>
                                  
                                        <tr>
                                            <td>N/A</td>
                                            <td>N/A</td>
                                        </tr>
                                   
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Total</strong></td>
                                        <td><strong>N/A</strong></td>
                                    </tr>
                                </tfoot>
                              </table>
                        }
                      
                    </div>
                  
                </div>
                <div class="modal-footer">
                    <button type="button" @onclick="@Hide_Popup_FicheAvanceDette" class="btn-c" data-dismiss="modal" aria-label="Close"> Anuller </button>

                </div>
            </div>
        </div>
    </div>
    <style>
        .table {
            width: 100%;
            border-collapse: collapse;
        }

            .table thead, .table tfoot {
                background-color: #f1f1f1; /* Optional for visibility */
            }

            .table th, .table td {
                padding: 8px;
                text-align: left;
                border: 1px solid #ddd; /* Optional for better visibility */
            }

        .modal-footer {
            display: flex;
            justify-content: flex-end;}
    </style>
}
